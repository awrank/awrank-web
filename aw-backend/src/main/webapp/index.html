<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>AwRank</title>

	<!-- Fav and touch icons -->
	<!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="ico/apple-touch-icon-144-precomposed.png">-->
	<!--<link rel="apple-touch-icon-precomposed" sizes="72x72" href="ico/apple-touch-icon-72-precomposed.png">-->
	<!--<link rel="apple-touch-icon-precomposed" href="ico/apple-touch-icon-57-precomposed.png">-->
	<link rel="shortcut icon" href="resources/img/favicon.ico">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- JS -->
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.0.js"></script>
	<!--<script type="text/javascript" src="http://code.jquery.com/jquery-1.9.0.min.js"></script>-->
	<script type="text/javascript" src="http://jquery-json.googlecode.com/files/jquery.json-2.4.js"></script>
	<!--<script type="text/plain" src="http://jquery-json.googlecode.com/files/jquery.json-2.4.min.js"></script>-->
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-transition.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-alert.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-modal.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-dropdown.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-scrollspy.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-tab.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-tooltip.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-popover.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-button.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-collapse.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-carousel.js"></script>
	<script type="text/javascript" src="resources/js/bootstrap/bootstrap-typeahead.js"></script>
	<script type="text/javascript" src="resources/js/underscore.js"></script>
	<script type="text/javascript" src="resources/js/backbone.js"></script>
	<script type="text/javascript" src="resources/js/awrank.js"></script>
	<script type="text/javascript" src="resources/js/awrank_lng.js"></script>
	<!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

	<!-- Le styles -->
	<link href="resources/css/bootstrap.css" rel="stylesheet">
	<link href="resources/css/bootstrap-responsive.css" rel="stylesheet">
	<link href="resources/css/bootstrap-formhelpers-countries.flags.css" rel="stylesheet">
	<link href="resources/css/awrank.css" rel="stylesheet">

	<style type="text/css">
		body {
			padding-top: 60px;
			padding-bottom: 40px;
		}

		.sidebar-nav {
			padding: 9px 0;
		}
	</style>
</head>

<body onload="fIndexBodyOnload()">

<div class="container-fluid">

<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container-fluid">
			<a class="brand" href="#">AwRank</a>
			<ul class="nav pull-right">
				<li class="text-info span2">
					<!--<span lngt="HELLO_USERNAME"></span>-->
					<a href="#profile">$Username</a>
				</li>
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-user icon-white"></i>
						<span lngt="MY_ACCOUNT">My account</span> <b class="caret"></b></a>
					<ul class="dropdown-menu">
						<li><a href="#">Action</a></li>
						<li class="divider"></li>
						<li><a onclick="send_user_logout();" lngt="LOGOUT">Log out</a></li>
					</ul>
				</li>
				<li class="dropdown" style="z-index: 10000">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="icon-globe icon-white"></i>
						<span id="languageLabel">RU</span> <b class="caret"></b></a>
					<ul class="dropdown-menu">
						<li><a href="#" onclick="$('#languageLabel').text('EN');setLanguage('EN')"><i
								class="icon-flag-GB"></i>EN</a></li>
						<li><a href="#" onclick="$('#languageLabel').text('RU');setLanguage('RU')"><i
								class="icon-flag-RU"></i>RU</a></li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
</div>

<div class="row-fluid">
<div class="span3">
	<div class="well sidebar-nav">
		<ul id="menu" class="nav nav-list">
			<li class="nav-header" lngt="SITE">SITE</li>
			<li id="menuItemHome">
				<a href="#">
					<i class="icon-home"></i> <span lngt="HOME">Home</span>
				</a>
			</li>
			<li id="menuItemOrder">
				<a href="#order">
					<i class="icon-shopping-cart"></i> <span lngt="ORDER">Order</span>
				</a>
			</li>

			<!-- ACCOUNT -->
			<li class="nav-header" lngt="ACCOUNT">ACCOUNT</li>
			<li id="menuItemProfile">
				<a href="#profile">
					<i class="icon-user"></i> <span lngt="PROFILE">Profile</span>
				</a>
			</li>
			<li id="menuItemApplication">
				<a href="#application">
					<i class="icon-folder-open"></i> <span lngt="APPLICATION"></span>
				</a></li>

			<!-- ACTIVITY -->
			<li class="nav-header" lngt="ACTIVITY">ACTIVITY</li>
			<li id="menuItemRequestHistory">
				<a href="#requestHistory">
					<i class="icon-eye-open"></i> <span lngt="REQUEST_HISTORY"></span>
				</a>
			</li>
			<li id="menuItemSessionHistory">
				<a href="#sessionHistory">
					<i class="icon-time"></i> <span lngt="SESSION_HISTORY"></span>
				</a>
			</li>
			<li id="menuItemPaymentHistory">
				<a href="#payment_history">
					<i class="icon-calendar"></i><span lngt="PAYMENT_HISTORY">Payment history</span>
				</a>
			</li>

			<!-- ADMINISTRATION-->
			<li class="nav-header" lngt="ADMINISTRATION">Administration</li>
			<li id="menuItemDictionary">
				<a href="#dictionary">
					<i class="icon-book"></i> <span lngt="DICTIONARY">Dictionary</span>
				</a>
			</li>
			<li id="menuItemUserList">
				<a href="#userList">
					<i class="icon-list"></i> <span lngt="USER_LIST"></span>
				</a>
			</li>
			<li id="menuItemManageUsers">
				<a href="#manageUsers">
					<i class="icon-edit"></i> <span lngt="MANAGE_USERS"></span>
				</a>
			</li>
			<li id="menuItemLogs">
				<a href="#logs">
					<i class="icon-pencil"></i> <span lngt="LOGS"></span>
				</a>
			</li>
		</ul>
	</div>
	<!--/.well -->
</div>
<!--/span-->
<div id="rightContent" class="span9">


	<div id="divPaymentHistory" class="">

		<div class="row">
			<div class="span6">
				<h4 lngt="PAYMENT_HISTORY">Payment history</h4>
			</div>
			<div class="span6">
				<div class="btn-group pull-right">
					<button id="paymentHistoryPageSize" class="btn" value="10">10</button>
					<button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
					<ul class="dropdown-menu">
						<li><a onclick="paymentHistoryPageSizeChange(this)" value="10">10</a></li>
						<li><a onclick="paymentHistoryPageSizeChange(this)" value="20">20</a></li>
						<li><a onclick="paymentHistoryPageSizeChange(this)" value="50">50</a></li>
						<li class="divider"></li>
						<li><a href="#" lngt="SESSION_PAGING_ALL" onclick="paymentHistoryPageSizeChange(this)"
							   value="0">all</a></li>
					</ul>
				</div>
			</div>
		</div>

		<table id="divPaymentHistoryTable" class="table table-striped">
			<thead>
			<tr>
				<th lngt="PAYMENT_HISTORY_TABLE_COLUMN_TARIFF">Tariff</th>
				<th lngt="PAYMENT_HISTORY_TABLE_COLUMN_PRICE">Price</th>
				<th></th>
				<th lngt="PAYMENT_HISTORY_TABLE_COLUMN_PAYMENT_SYSTEM">Payment system</th>
				<th lngt="PAYMENT_HISTORY_TABLE_COLUMN_DATE_BEGIN">Begin</th>
				<th lngt="PAYMENT_HISTORY_TABLE_COLUMN_DATE_END">End</th>
			</tr>
			</thead>
			<tbody>
			<script type="text/template">
				<tr payment_id="<%=id%>">
					<td lngt="<%=productName%>"></td>
					<td><%=amount%></td>
					<td lngt="<%=currency%>"></td>
					<td lngt="<%=paymentSystemType%>"></td>
					<td><%=dateTimeToString(date_begin)%></td>
					<td><%=dateTimeToString(date_end)%></td>
				</tr>
			</script>
			</tbody>
		</table>

		<div id="paymentHistoryPager" class="pagination pagination-centered">
		</div>
		<script type="text/javascript" language="JavaScript">
			var CPaymentHistory = Backbone.Model.extend({
			});
			var CPaymentHistoryList = Backbone.Collection.extend({
				url: 'rest/payment_history/',
				model: CPaymentHistory
			});
			var CPaymentHistoryListView = Backbone.View.extend({
				el: $('#divPaymentHistoryTable'),
				initialize: function () {
					var o = $('#divPaymentHistoryTable script');
					this.template = _.template(o.html());
					o.remove();
				},
				events: {
//							"click a": "selectRow",
//							"click input": "deleteRow"
				},

				render: function () {
					var tbody = this.$el.find('tbody');
					tbody.empty();
					for (var i = (this.page - 1) * this.pageSize; (this.pageSize == 0 || i < this.page * this.pageSize) && i < this.collection.size(); i++) {
						var attr = this.collection.at(i).toJSON();
						tbody.append(this.template(attr));
					}
					localizeLoadContent(this.$el);
					return this;
				},
				onSelectPage: function (page) {
					var pageSize = $('#paymentHistoryPageSize').attr('value');
					var lastPage = (pageSize > 0) ? Math.ceil(this.collection.size() / pageSize) : 1;
					if (this.page != page || this.pageSize != pageSize || this.lastPage != lastPage) {
						this.page = page;
						this.pageSize = pageSize;
						this.lastPage = lastPage;
						renderPageButton('paymentHistoryPager', this.page, this.lastPage, 'paymentHistoryListView.onSelectPage');
						this.render();
					}
				}

			});

			var paymentHistoryList = new CPaymentHistoryList();
			var paymentHistoryListView = new CPaymentHistoryListView({collection: paymentHistoryList});
			paymentHistoryList.fetch({success: function () {
				paymentHistoryListView.onSelectPage(1);
			}});

			function paymentHistoryPageSizeChange(o) {
				var paymentHistoryPageSize = $('#paymentHistoryPageSize');
				var $o = $(o);
				paymentHistoryPageSize.text($o.text());
				paymentHistoryPageSize.attr('value', $o.attr('value'));
				var lngt = $o.attr('lngt');
				if (lngt != null) {
					paymentHistoryPageSize.attr('lngt', lngt);
				}
				else {
					paymentHistoryPageSize.removeAttr('lngt');
				}
				paymentHistoryListView.onSelectPage(1);
			}

			function renderPageButton(pagerId, page, lastPage, onSelectPage) {
//						1 2 3 4 5 6 7 8 9
//						1 . 4 5 6 7 8 . 11
				var pager = $('#' + pagerId);
				pager.empty();
				var s = '<ul>';
				if (lastPage > 1) {
					if (page > 1)
						s += '<li><a onclick="' + onSelectPage + '(' + (page - 1) + ')"><i class="icon-backward"></i></a></li>';
					var firstViewPage;
					if (lastPage > 9 && page > 5) {
						s += '<li><a onclick="' + onSelectPage + '(1)">1</a></li>';
						s += '<li class="disabled"><a>...</a></li>';
						firstViewPage = Math.min(lastPage - 6, page - 2);
					}
					else {
						firstViewPage = 1;
					}
					var lastViewPage = Math.min(firstViewPage + 4, lastPage);
					if (lastPage > 9 && (lastPage - page) >= 5) {
						lastViewPage = Math.max(7, page + 2);
					}
					else {
						lastViewPage = lastPage;
					}
					for (var i = firstViewPage; i <= lastViewPage; i++) {
						if (i == page) {
							s += '<li class="active"><a>' + i + '</a></li>';
						}
						else {
							s += '<li><a onclick="' + onSelectPage + '(' + i + ')">' + i + '</a></li>';
						}
					}
					if (lastPage > 9 && (lastPage - page) >= 5) {
						s += '<li class="disabled"><a>...</a></li>';
						s += '<li><a onclick="' + onSelectPage + '(' + lastPage + ')">' + lastPage + '</a></li>';
					}
					if (page < lastPage) {
						s += '<li><a onclick="' + onSelectPage + '(' + (page + 1) + ')"><i class="icon-forward"></i></a></li>';
					}
				}
				s += '</ul>';
				pager.append(s);
			}

		</script>
	</div>


</div>
<!--/span-->
</div>
<!--/row-->

<footer>
	<p>&copy; AwRank 2013</p>
</footer>

</div>


<script type="text/javascript" language="JavaScript">

	Backbone.history.start();
	awrankRouter = new CRouter();

	function fIndexBodyOnload() {
//		setContextPath('http://localhost:8080/awrank');
//		setContextPath('http://localhost:8080/aw-backend');
		setLanguage('RU');
		awrankRouter.navigate('order', {trigger: true});
		activeAjaxListener();
	}

</script>
</body>
</html>
